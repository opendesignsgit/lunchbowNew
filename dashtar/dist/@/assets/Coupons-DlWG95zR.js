import{r as t,j as e,f as l,F as z}from"./index-CeVDEEei.js";import{P as _}from"./PageTitle-BNFwlyPJ.js";const S=10,U=()=>{const[h,T]=t.useState([]),[N,v]=t.useState(0),[s,r]=t.useState(1),[A,D]=t.useState(!0),[E,P]=t.useState(null),[x,R]=t.useState(""),[u,F]=t.useState(""),[p,k]=t.useState(""),[f,g]=t.useState({fatherName:"",mobile:"",email:""}),j=t.useRef(null),b=t.useRef(null),y=t.useRef(null),m=async(a=1,n="",i="",o="")=>{var c,d;D(!0),P(null);try{const L=n.trim()||i.trim()||o.trim()?"http://localhost:5055/api/orders/get-All/user-Subscription/search":"http://localhost:5055/api/orders/get-All/user-Subscription",B=await z.get(L,{params:{page:a,limit:S,fatherName:n,mobile:i,email:o}});T(B.data.subscriptions||[]),v(B.data.total||0)}catch(w){P(((d=(c=w.response)==null?void 0:c.data)==null?void 0:d.message)||w.message),T([]),v(0)}finally{D(!1)}};t.useEffect(()=>{m(1,"","",""),g({fatherName:"",mobile:"",email:""}),r(1)},[]),t.useEffect(()=>{s!==1&&m(s,f.fatherName,f.mobile,f.email)},[s]);const I=a=>{a.preventDefault(),r(1),g({fatherName:x,mobile:u,email:p}),m(1,x,u,p)},M=()=>{R(""),F(""),k(""),j.current&&(j.current.value=""),b.current&&(b.current.value=""),y.current&&(y.current.value=""),r(1),g({fatherName:"",mobile:"",email:""}),m(1,"","","")},C=Math.ceil((N||0)/S);return A?e.jsx("div",{children:"Loading..."}):E?e.jsxs("div",{children:["Error: ",E]}):e.jsxs("div",{children:[e.jsx(_,{children:"User Subscriptions"}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:I,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:j,type:"search",name:"fatherName",value:x,onChange:a=>R(a.target.value),placeholder:"Search by Father's Name",className:"mb-2"})}),e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:b,type:"search",name:"mobile",value:u,onChange:a=>F(a.target.value),placeholder:"Search by Mobile",className:"mb-2"})}),e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:y,type:"search",name:"email",value:p,onChange:a=>k(a.target.value),placeholder:"Search by Email",className:"mb-2"})}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx(l.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Filter"}),e.jsx(l.Button,{layout:"outline",onClick:M,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Reset"})})]})]})})}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden",children:e.jsxs(l.CardBody,{children:[Array.isArray(h)&&h.length===0?e.jsx("p",{children:"No subscriptions found."}):e.jsx(l.TableContainer,{children:e.jsxs(l.Table,{children:[e.jsx(l.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(l.TableCell,{children:"#"}),e.jsx(l.TableCell,{children:"Father Name"}),e.jsx(l.TableCell,{children:"Mobile"}),e.jsx(l.TableCell,{children:"Email"}),e.jsx(l.TableCell,{children:"Plan"}),e.jsx(l.TableCell,{children:"Start Date"}),e.jsx(l.TableCell,{children:"End Date"}),e.jsx(l.TableCell,{children:"Amount"}),e.jsx(l.TableCell,{children:"Payment Status"})]})}),e.jsx(l.TableBody,{children:h.map((a,n)=>{var i,o,c,d;return e.jsxs(l.TableRow,{children:[e.jsx(l.TableCell,{children:(s-1)*S+n+1}),e.jsx(l.TableCell,{children:a.parentName}),e.jsx(l.TableCell,{children:a.mobile}),e.jsx(l.TableCell,{children:a.email}),e.jsx(l.TableCell,{children:((i=a.planDetails)==null?void 0:i.planId)||""}),e.jsx(l.TableCell,{children:(o=a.planDetails)!=null&&o.startDate?new Date(a.planDetails.startDate).toLocaleDateString():""}),e.jsx(l.TableCell,{children:(c=a.planDetails)!=null&&c.endDate?new Date(a.planDetails.endDate).toLocaleDateString():""}),e.jsx(l.TableCell,{children:(d=a.planDetails)!=null&&d.price?`â‚¹${a.planDetails.price}`:""}),e.jsxs(l.TableCell,{children:[a.paymentStatus===!0&&"Paid",a.paymentStatus===!1&&"Pending",typeof a.paymentStatus!="boolean"&&""]})]},a._id||n)})})]})}),N>0&&e.jsxs("div",{style:{marginTop:"1em",display:"flex",justifyContent:"flex-end",alignItems:"center"},children:[e.jsx(l.Button,{layout:"outline",size:"small",onClick:()=>r(a=>Math.max(a-1,1)),disabled:s===1,children:"Prev"}),e.jsxs("span",{style:{margin:"0 1em"},children:["Page ",s," of ",C]}),e.jsx(l.Button,{layout:"outline",size:"small",onClick:()=>r(a=>Math.min(a+1,C)),disabled:s===C,children:"Next"})]})]})})]})};export{U as default};

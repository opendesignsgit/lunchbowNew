import{r as x,S as G,i as J,j as e,f as a,k as R,s as se}from"./index-CeVDEEei.js";import{u as q,S as te,I as ae,j as le,g as ne,h as re,i as ie}from"./Layout-CcMNNaZ4.js";import{T as de,C as Q,S as oe,B as ce}from"./BulkActionDrawer-DL-gEJMB.js";import{u as X}from"./useToggleDrawer-CzZxNYTz.js";import{D as Z}from"./DeleteModal-C2V44Xok.js";import{T as K,D as me,M as pe}from"./DrawerButton-DmwH5vsU.js";import{T as he}from"./ParentCategory-DY3BP5-Z.js";import{a as V,n as W}from"./toast-C-sk6pTy.js";import{u as xe,E as Y}from"./index.esm-BcFVggIo.js";import{I as ue}from"./InputArea-B4G6HLhq.js";import{L as H}from"./LabelArea-B-7rwQwm.js";import{S as ge}from"./SwitchToggle-BpQKILyD.js";import{U as je}from"./Uploader-CnAnvJ4p.js";import{C as M,u as fe}from"./useFilter-Bo7z1Qkl.js";import{u as be}from"./useTranslationValue-Z9kdRa0m.js";import{E as Ce}from"./EditDeleteButton-o-BiuxpI.js";import{L as Ne}from"./Loading-ChtgZD95.js";import{N as Te}from"./NotFound-DqH5GUVC.js";import{P as ve}from"./PageTitle-BNFwlyPJ.js";import{u as Se}from"./useAsync-BXK40Pcd.js";import{A as we}from"./AnimatedContent-DFcCCmNs.js";import"./iconBase-DoKym2qq.js";import"./index.prod-DwQ_UEEY.js";import"./CouponServices-BoIMl-hX.js";import"./CurrencyServices-_K0iNOM8.js";import"./ProductServices-Du5OybLf.js";import"./index-rlwwEboC.js";import"./useDisableForDemo-CHynow2B.js";import"./spinner-CkndCogW.js";import"./AdminServices-DuO9aYE5.js";import"./SelectLanguageTwo-CNfN2jle.js";import"./_commonjs-dynamic-modules-LM44EJN2.js";import"./Tooltip-Dkk_fvLX.js";const Ae=(d,c)=>{const{isDrawerOpen:i,closeDrawer:f,setIsUpdate:b,lang:S}=x.useContext(G),[u,C]=x.useState({}),[N,A]=x.useState(""),[I,T]=x.useState(""),[_,s]=x.useState([]),[n,g]=x.useState("en"),[j,D]=x.useState(!0),[m,F]=x.useState(""),[L,w]=x.useState(!1),{handlerTextTranslateHandler:k}=be(),{register:l,handleSubmit:v,setValue:t,clearErrors:h,reset:U,formState:{errors:O}}=xe(),p=async({name:o,description:r})=>{var E,y;try{w(!0);const P=await k(o,n,u==null?void 0:u.name),ee=await k(r,n,u==null?void 0:u.description),z={name:{...P,[n]:o},description:{...ee,[n]:r||""},parentId:N||void 0,parentName:m||"Home",icon:I,status:j?"show":"hide",lang:n};if(d){const $=await M.updateCategory(d,z);b(!0),w(!1),W($.message),f(),U()}else{const $=await M.addCategory(z);b(!0),w(!1),W($.message),f()}}catch(P){w(!1),V(P?(y=(E=P==null?void 0:P.response)==null?void 0:E.data)==null?void 0:y.message:P==null?void 0:P.message),f()}},B=o=>{g(o),Object.keys(u).length>0&&(t("name",u.name[o||"en"]),t("description",u.description[o||"en"]))};return x.useEffect(()=>{var o;if(!i){C({}),t("name"),t("parentId"),t("parentName"),t("description"),t("icon"),T(""),D(!0),h("name"),h("parentId"),h("parentName"),h("description"),F("Home"),g(S),t("language",n),c!==void 0&&((o=c[0])==null?void 0:o._id)!==void 0&&A(c[0]._id);return}d&&(async()=>{try{const r=await M.getCategoryById(d);r&&(C(r),t("name",r.name[n||"en"]),t("description",r.description[n||"en"]),t("language",n),t("parentId",r.parentId),t("parentName",r.parentName),F(r.parentName),A(r.parentId),T(r.icon),D(r.status==="show"))}catch(r){V(r?r.response.data.message:r.message)}})()},[d,t,i,n,h,c,S]),{register:l,handleSubmit:v,onSubmit:p,errors:O,imageUrl:I,setImageUrl:T,children:_,setChildren:s,published:j,setPublished:D,checked:N,setChecked:A,isSubmitting:L,selectCategoryName:m,setSelectCategoryName:F,handleSelectLanguage:B}},Ie=({id:d,data:c})=>{const{t:i}=J(),{checked:f,register:b,onSubmit:S,handleSubmit:u,errors:C,imageUrl:N,setImageUrl:A,published:I,setPublished:T,setChecked:_,selectCategoryName:s,setSelectCategoryName:n,handleSelectLanguage:g,isSubmitting:j}=Ae(d,c),{showingTranslateValue:D}=q(),m=`
  .rc-tree-child-tree {
    display: hidden;
  }
  .node-motion {
    transition: all .3s;
    overflow-y: hidden;
  }
`,F={motionName:"node-motion",motionAppear:!1,onAppearStart:l=>({height:0}),onAppearActive:l=>({height:l.scrollHeight}),onLeaveStart:l=>({height:l.offsetHeight}),onLeaveActive:()=>({height:0})},L=l=>{let v=[];for(let t of l)v.push({title:D(t.name),key:t._id,children:t.children.length>0&&L(t.children)});return v},w=(l,v)=>{var t;return l._id===v?l:(t=l==null?void 0:l.children)==null?void 0:t.reduce((h,U)=>h??w(U,v),void 0)},k=async l=>{if(l!==void 0)if(d){const v=await M.getCategoryById(l);if(d===l)return V("This can't be select as a parent category!");if(d===v.parentId)return V("This can't be select as a parent category!");{if(l===void 0)return;_(l);const t=c[0],h=w(t,l);n(D(h==null?void 0:h.name))}}else{if(l===void 0)return;_(l);const v=c[0],t=w(v,l);n(D(t==null?void 0:t.name))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:d?e.jsx(K,{register:b,handleSelectLanguage:g,title:i("UpdateCategory"),description:i("UpdateCategoryDescription")}):e.jsx(K,{register:b,handleSelectLanguage:g,title:i("AddCategoryTitle"),description:i("AddCategoryDescription")})}),e.jsx(te,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:u(S),children:[e.jsxs("div",{className:"p-6 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(H,{label:i("Name")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(ue,{required:!0,register:b,label:"Category title",name:"name",type:"text",placeholder:i("ParentCategoryPlaceholder")}),e.jsx(Y,{errorName:C.name})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(H,{label:i("Description")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(de,{register:b,label:"Description",name:"description",type:"text",placeholder:"Category Description"}),e.jsx(Y,{errorName:C.description})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(H,{label:i("ParentCategory")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4 relative",children:[e.jsx(a.Input,{readOnly:!0,...b("parent",{required:!1}),name:"parent",value:s||"Home",placeholder:i("ParentCategory"),type:"text"}),e.jsxs("div",{className:"draggable-demo capitalize",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:m}}),e.jsx(he,{expandAction:"click",treeData:L(c),selectedKeys:[f],onSelect:l=>k(l[0]),motion:F,animation:"slide-up"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(H,{label:i("CategoryIcon")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(je,{imageUrl:N,setImageUrl:A,folder:"category",targetWidth:238,targetHeight:238})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(H,{label:i("Published")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ge,{handleProcess:T,processOption:I})})]})]}),e.jsx(me,{id:d,title:"Category",isSubmitting:j})]})})]})},_e=({data:d,lang:c,isCheck:i,categories:f,setIsCheck:b,useParamId:S,showChild:u})=>{const{title:C,serviceId:N,handleModalOpen:A,handleUpdate:I}=X(),{showingTranslateValue:T}=q(),_=s=>{const{id:n,checked:g}=s.target;b([...i,n]),g||b(i.filter(j=>j!==n))};return e.jsxs(e.Fragment,{children:[(i==null?void 0:i.length)<1&&e.jsx(Z,{useParamId:S,id:N,title:C}),e.jsx(pe,{children:e.jsx(Ie,{id:N,data:d,lang:c})}),e.jsx(a.TableBody,{children:f==null?void 0:f.map(s=>{var n,g;return e.jsxs(a.TableRow,{children:[e.jsx(a.TableCell,{children:e.jsx(Q,{type:"checkbox",name:"category",id:s._id,handleClick:_,isChecked:i==null?void 0:i.includes(s._id)})}),e.jsx(a.TableCell,{className:"font-semibold uppercase text-xs",children:(n=s==null?void 0:s._id)==null?void 0:n.substring(20,24)}),e.jsx(a.TableCell,{children:s!=null&&s.icon?e.jsx(a.Avatar,{className:"hidden mr-3 md:block bg-gray-50 p-1",src:s==null?void 0:s.icon,alt:s==null?void 0:s.parent}):e.jsx(a.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product",className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none"})}),e.jsx(a.TableCell,{className:"font-medium text-sm ",children:(s==null?void 0:s.children.length)>0?e.jsxs(R,{to:`/categories/${s==null?void 0:s._id}`,className:"text-blue-700",children:[T(s==null?void 0:s.name),e.jsx(e.Fragment,{children:u&&e.jsxs(e.Fragment,{children:[" ",e.jsx("div",{className:"pl-2 ",children:(g=s==null?void 0:s.children)==null?void 0:g.map(j=>e.jsx("div",{children:e.jsx(R,{to:`/categories/${j==null?void 0:j._id}`,className:"text-blue-700",children:e.jsxs("div",{className:"flex text-xs items-center  text-blue-800",children:[e.jsx("span",{className:" text-xs text-gray-500 pr-1",children:e.jsx(ae,{})}),e.jsx("span",{className:"text-gray-500",children:T(j.name)})]})})},j._id))})]})})]}):e.jsx("span",{children:T(s==null?void 0:s.name)})}),e.jsx(a.TableCell,{className:"text-sm",children:T(s==null?void 0:s.description)}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx(oe,{id:s._id,category:!0,status:s.status})}),e.jsx(a.TableCell,{children:e.jsx(Ce,{id:s==null?void 0:s._id,parent:s,isCheck:i,children:s==null?void 0:s.children,handleUpdate:I,handleModalOpen:A,title:T(s==null?void 0:s.name)})})]},s._id)})})]})},ds=()=>{const{id:d}=se(),[c,i]=x.useState([]),[f,b]=x.useState([]),[S,u]=x.useState(!1),[C,N]=x.useState([]),{toggleDrawer:A,lang:I}=x.useContext(G),{handleDeleteMany:T,allId:_,handleUpdateMany:s}=X(),{data:n,loading:g,error:j}=Se(M.getAllCategory),{showingTranslateValue:D}=q(),{t:m}=J();x.useEffect(()=>{var U,O;const t=(p,B,o=[])=>{for(let r of B){if(r._id===p)return o.concat(r);const E=t(p,r==null?void 0:r.children,o==null?void 0:o.concat(r));if(E)return E}},h=(p,B)=>{var o;return p._id===B?p:(o=p==null?void 0:p.children)==null?void 0:o.reduce((r,E)=>r??h(E,B),void 0)};if(!g){const p=h(n[0],d),B=t(d,(U=n[0])==null?void 0:U.children);((O=p==null?void 0:p.children)==null?void 0:O.length)>0&&(i(p==null?void 0:p.children),b(B))}},[d,g,n,c]);const{totalResults:F,resultsPerPage:L,dataTable:w,serviceData:k,handleChangePage:l}=fe(c),v=()=>{u(!S),N(c==null?void 0:c.map(t=>t._id)),S&&N([])};return e.jsxs(e.Fragment,{children:[e.jsx(ve,{children:m("CategoryPageTitle")}),e.jsx(Z,{ids:_,setIsCheck:N,category:!0}),e.jsx(ce,{ids:_,title:"Child Categories",lang:I,data:n,childId:d}),e.jsxs(we,{children:[e.jsx("div",{className:"flex items-center pb-4",children:e.jsxs("ol",{className:"flex items-center w-full overflow-hidden font-serif",children:[e.jsx("li",{className:"text-sm pr-1 transition duration-200 ease-in cursor-pointer hover:text-emerald-500 font-semibold",children:e.jsx(R,{to:"/categories",children:m("Categories")})}),f==null?void 0:f.map((t,h)=>e.jsxs("span",{className:"flex items-center font-serif",children:[e.jsxs("li",{className:"text-sm mt-[1px]",children:[" ",e.jsx(le,{})," "]}),e.jsx("li",{className:"text-sm pl-1 transition duration-200 ease-in cursor-pointer text-blue-700 hover:text-emerald-500 font-semibold ",children:e.jsx(R,{to:`/categories/${t._id}`,children:D(t==null?void 0:t.name)})})]},h+1))]})}),e.jsx(a.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(a.CardBody,{children:e.jsxs("div",{className:"flex justify-end items-end",children:[e.jsxs(a.Button,{onClick:A,className:"rounded-md h-12",children:[e.jsx("span",{className:"mr-3",children:e.jsx(ne,{})}),m("AddCategory")]}),e.jsx("div",{className:"ml-3 w-full md:w-24 lg:w-24 xl:w-24",children:e.jsxs(a.Button,{disabled:C.length<1,onClick:()=>s(C),className:"w-full rounded-md h-12",children:[e.jsx(re,{}),m("BulkAction")]})}),e.jsxs(a.Button,{disabled:C.length<1,onClick:()=>T(C),className:"ml-3 rounded-md h-12 bg-red-500",children:[e.jsx("span",{className:"mr-3",children:e.jsx(ie,{})}),m("Delete")]})]})})})]}),g?e.jsx(Ne,{loading:g}):j?e.jsx("span",{className:"text-center mx-auto text-red-500",children:j}):(k==null?void 0:k.length)!==0?e.jsxs(a.TableContainer,{className:"mb-8",children:[e.jsxs(a.Table,{children:[e.jsx(a.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(a.TableCell,{children:e.jsx(Q,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:v,isChecked:S})}),e.jsx(a.TableCell,{children:m("catIdTbl")}),e.jsx(a.TableCell,{children:m("catIconTbl")}),e.jsx(a.TableCell,{children:m("Name")}),e.jsx(a.TableCell,{children:m("Description")}),e.jsx(a.TableCell,{className:"text-center",children:m("catPublishedTbl")}),e.jsx(a.TableCell,{className:"text-right",children:m("catActionsTbl")})]})}),e.jsx(_e,{categories:w,data:n,lang:I,isCheck:C,setIsCheck:N,useParamId:d})]}),e.jsx(a.TableFooter,{children:e.jsx(a.Pagination,{totalResults:F,resultsPerPage:L,onChange:l,label:"Table navigation"})})]}):e.jsx(Te,{title:"Sorry, There are no categories right now."})]})};export{ds as default};

import{r as a,j as e,f as l}from"./index-CeVDEEei.js";import{P as z}from"./PageTitle-BNFwlyPJ.js";import{O as B}from"./OrderServices-CIJ3JxcB.js";const u=10,R=()=>{const i=new Date,f=i.getFullYear(),g=String(i.getMonth()+1).padStart(2,"0"),j=String(i.getDate()).padStart(2,"0");return`${f}-${g}-${j}`},H=()=>{const[i,f]=a.useState([]),[g,j]=a.useState(0),[o,p]=a.useState(1),[A,L]=a.useState(!0),[E,O]=a.useState(null),[S,$]=a.useState(""),[c,k]=a.useState(R()),N=a.useRef(null),T=a.useRef(null),[b,x]=a.useState([]),y=async(t=1,d="",m="")=>{var w,C;L(!0),O(null);try{let n;if(d||m?n=await B.searchOrders({childName:d,date:m,page:t,limit:u}):n=await B.getAllFoodOrders({page:t,limit:u}),f(n.orders||[]),j(n.total||0),x(n.dishSummary||[]),m){const r=d||m?n.orders||[]:i,s={};r.forEach(h=>{new Date(h.date).toLocaleDateString()===new Date(m).toLocaleDateString()&&(s[h.food]?s[h.food]++:s[h.food]=1)});const D=Object.entries(s).map(([h,M])=>({dish:h,count:M}));x(D)}else x([])}catch(n){O(((C=(w=n.response)==null?void 0:w.data)==null?void 0:C.message)||n.message),f([]),j(0),x([])}finally{L(!1)}};a.useEffect(()=>{y(1,"",R())},[]),a.useEffect(()=>{o!==1&&y(o,S,c)},[o]);const F=t=>{t.preventDefault(),p(1),y(1,S,c)},I=()=>{$(""),k(""),N.current&&(N.current.value=""),T.current&&(T.current.value=""),p(1),x([]),y(1,"","")},P=()=>{let t="";c&&b.length>0&&(t+=`Dish Summary for ${new Date(c).toLocaleDateString()}
`,t+=["Dish","Count"].join(",")+`
`,b.forEach(s=>{t+=[`"${s.dish.replace(/"/g,'""')}"`,`"${s.count}"`].join(",")+`
`}),t+=`
`);const d=["#","Child Name","School","Lunch Time","Location","Date","Food"].join(","),m=i.map((s,D)=>[(o-1)*u+D+1,`${s.childFirstName} ${s.childLastName}`,s.school,s.lunchTime,s.location,s.date?new Date(s.date).toLocaleDateString():"",s.food].map(h=>`"${String(h).replace(/"/g,'""')}"`).join(",")),w=t+[d,...m].join(`
`),C=new Blob([w],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(C),r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",`orders_${new Date().toISOString().slice(0,10)}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},v=Math.ceil((g||0)/u);return A?e.jsx("div",{children:"Loading..."}):E?e.jsxs("div",{children:["Error: ",E]}):e.jsxs("div",{children:[e.jsx(z,{children:"Orders"}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:F,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:N,type:"search",name:"childName",value:S,onChange:t=>$(t.target.value),placeholder:"Search by Child Name",className:"mb-2"})}),e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:T,type:"date",name:"date",value:c,onChange:t=>k(t.target.value),className:"mb-2"})}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx(l.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Filter"}),e.jsx(l.Button,{layout:"outline",onClick:I,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Reset"})})]})]})})}),c&&b.length>0&&e.jsx("div",{className:"mb-6 flex flex-wrap gap-4",children:b.map((t,d)=>e.jsx(l.Card,{className:"w-full sm:w-1/2 md:w-1/3 lg:w-1/5 xl:w-1/6 min-w-[170px] bg-gradient-to-br from-emerald-200 to-emerald-100 border border-emerald-300",children:e.jsxs(l.CardBody,{className:"flex flex-col items-center text-center",children:[e.jsx("span",{className:"text-xl font-semibold text-emerald-800 mb-1",children:t.dish}),e.jsx("span",{className:"text-3xl font-bold text-emerald-900",children:t.count}),e.jsx("span",{className:"text-xs text-emerald-700 mt-1",children:c?`on ${new Date(c).toLocaleDateString()}`:""})]})},t.dish))}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden",children:e.jsxs(l.CardBody,{children:[Array.isArray(i)&&i.length===0?e.jsx("p",{children:"No orders found."}):e.jsx(l.TableContainer,{children:e.jsxs(l.Table,{children:[e.jsx(l.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(l.TableCell,{children:"#"}),e.jsx(l.TableCell,{children:"Child Name"}),e.jsx(l.TableCell,{children:"School"}),e.jsx(l.TableCell,{children:"Lunch Time"}),e.jsx(l.TableCell,{children:"Location"}),e.jsx(l.TableCell,{children:"Date"}),e.jsx(l.TableCell,{children:"Food"})]})}),e.jsx(l.TableBody,{children:i.map((t,d)=>e.jsxs(l.TableRow,{children:[e.jsx(l.TableCell,{children:(o-1)*u+d+1}),e.jsxs(l.TableCell,{children:[t.childFirstName," ",t.childLastName]}),e.jsx(l.TableCell,{children:t.school}),e.jsx(l.TableCell,{children:t.lunchTime}),e.jsx(l.TableCell,{children:t.location}),e.jsx(l.TableCell,{children:t.date?new Date(t.date).toLocaleDateString():""}),e.jsx(l.TableCell,{children:t.food})]},t.childId+t.date+t.food))})]})}),g>0&&e.jsxs("div",{style:{marginTop:"1em",display:"flex",justifyContent:"space-between"},children:[e.jsx(l.Button,{onClick:P,layout:"outline",size:"small",children:"Download CSV"}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(l.Button,{layout:"outline",size:"small",onClick:()=>p(t=>Math.max(t-1,1)),disabled:o===1,children:"Prev"}),e.jsxs("span",{style:{margin:"0 1em"},children:["Page ",o," of ",v]}),e.jsx(l.Button,{layout:"outline",size:"small",onClick:()=>p(t=>Math.min(t+1,v)),disabled:o===v,children:"Next"})]})]})]})})]})};export{H as default};
